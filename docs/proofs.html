<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>C Proofs | Tidy Finance with R</title>
<meta name="author" content="Christoph Scheuch (wikifolio Financial Technologies) and Stefan Voigt (University of Copenhagen and Danish Finance Institute) and Patrick Weiss (Reykjavik University and Vienna University of Economics and Business)">
<meta name="description" content="C.1 Optimal portfolio choice  C.1.1 The minimum variance portfolio The minimum variance portfolio weights are given by the solution to \[\omega_\text{mvp} = \arg\min w'\Sigma w \text{ s.t. }...">
<meta name="generator" content="bookdown 0.32 with bs4_book()">
<meta property="og:title" content="C Proofs | Tidy Finance with R">
<meta property="og:type" content="book">
<meta property="og:url" content="https://www.tidy-finance.org/proofs.html">
<meta property="og:image" content="https://www.tidy-finance.org/cover_crc_tidy_finance.jpg">
<meta property="og:description" content="C.1 Optimal portfolio choice  C.1.1 The minimum variance portfolio The minimum variance portfolio weights are given by the solution to \[\omega_\text{mvp} = \arg\min w'\Sigma w \text{ s.t. }...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="C Proofs | Tidy Finance with R">
<meta name="twitter:description" content="C.1 Optimal portfolio choice  C.1.1 The minimum variance portfolio The minimum variance portfolio weights are given by the solution to \[\omega_\text{mvp} = \arg\min w'\Sigma w \text{ s.t. }...">
<meta name="twitter:image" content="https://www.tidy-finance.org/cover_crc_tidy_finance.jpg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script id="Cookiebot" src="https://consent.cookiebot.com/uc.js" data-cbid="71793ca0-15ca-4735-a61b-2a3e7a26a7b9" data-blockingmode="auto" type="text/javascript"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-DH3KZSMJ5W"></script><script data-cookieconsent="ignore">
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('consent', 'default', {ad_storage:'denied',analytics_storage:'denied'});
      gtag("set", "ads_data_redaction", true);
      gtag('js', new Date());
      gtag('config', 'G-DH3KZSMJ5W');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Tidy Finance with R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li class="book-part">Getting Started</li>
<li><a class="" href="introduction-to-tidy-finance.html"><span class="header-section-number">1</span> Introduction to Tidy Finance</a></li>
<li class="book-part">Financial Data</li>
<li><a class="" href="accessing-managing-financial-data.html"><span class="header-section-number">2</span> Accessing &amp; Managing Financial Data</a></li>
<li><a class="" href="wrds-crsp-and-compustat.html"><span class="header-section-number">3</span> WRDS, CRSP, and Compustat</a></li>
<li><a class="" href="trace-and-fisd.html"><span class="header-section-number">4</span> TRACE and FISD</a></li>
<li><a class="" href="other-data-providers.html"><span class="header-section-number">5</span> Other Data Providers</a></li>
<li class="book-part">Asset Pricing</li>
<li><a class="" href="beta-estimation.html"><span class="header-section-number">6</span> Beta Estimation</a></li>
<li><a class="" href="univariate-portfolio-sorts.html"><span class="header-section-number">7</span> Univariate Portfolio Sorts</a></li>
<li><a class="" href="size-sorts-and-p-hacking.html"><span class="header-section-number">8</span> Size Sorts and p-Hacking</a></li>
<li><a class="" href="value-and-bivariate-sorts.html"><span class="header-section-number">9</span> Value and Bivariate Sorts</a></li>
<li><a class="" href="replicating-fama-and-french-factors.html"><span class="header-section-number">10</span> Replicating Fama and French Factors</a></li>
<li><a class="" href="fama-macbeth-regressions.html"><span class="header-section-number">11</span> Fama-MacBeth Regressions</a></li>
<li class="book-part">Modeling &amp; Machine Learning</li>
<li><a class="" href="fixed-effects-and-clustered-standard-errors.html"><span class="header-section-number">12</span> Fixed Effects and Clustered Standard Errors</a></li>
<li><a class="" href="difference-in-differences.html"><span class="header-section-number">13</span> Difference in Differences</a></li>
<li><a class="" href="factor-selection-via-machine-learning.html"><span class="header-section-number">14</span> Factor Selection via Machine Learning</a></li>
<li><a class="" href="option-pricing-via-machine-learning.html"><span class="header-section-number">15</span> Option Pricing via Machine Learning</a></li>
<li class="book-part">Portfolio Optimization</li>
<li><a class="" href="parametric-portfolio-policies.html"><span class="header-section-number">16</span> Parametric Portfolio Policies</a></li>
<li><a class="" href="constrained-optimization-and-backtesting.html"><span class="header-section-number">17</span> Constrained Optimization and Backtesting</a></li>
<li class="book-part">References</li>
<li><a class="" href="references.html">References</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="cover-design.html"><span class="header-section-number">A</span> Cover Design</a></li>
<li><a class="" href="clean-enhanced-trace-with-r.html"><span class="header-section-number">B</span> Clean Enhanced TRACE with R</a></li>
<li><a class="active" href="proofs.html"><span class="header-section-number">C</span> Proofs</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/voigtstefan/tidy_finance">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="proofs" class="section level1" number="20">
<h1>
<span class="header-section-number">C</span> Proofs<a class="anchor" aria-label="anchor" href="#proofs"><i class="fas fa-link"></i></a>
</h1>
<div id="optimal-portfolio-choice-1" class="section level2" number="20.1">
<h2>
<span class="header-section-number">C.1</span> Optimal portfolio choice<a class="anchor" aria-label="anchor" href="#optimal-portfolio-choice-1"><i class="fas fa-link"></i></a>
</h2>
<div id="the-minimum-variance-portfolio" class="section level3" number="20.1.1">
<h3>
<span class="header-section-number">C.1.1</span> The minimum variance portfolio<a class="anchor" aria-label="anchor" href="#the-minimum-variance-portfolio"><i class="fas fa-link"></i></a>
</h3>
<p>The minimum variance portfolio weights are given by the solution to <span class="math display">\[\omega_\text{mvp} = \arg\min w'\Sigma w \text{ s.t. } \iota'w= 1,\]</span> where <span class="math inline">\(\iota\)</span> is an <span class="math inline">\((N \times 1)\)</span> vector of ones. The Lagrangian reads <span class="math display">\[ \mathcal{L}(\omega) = w'\Sigma w - \lambda(w'\iota - 1).\]</span> We can solve the first-order conditions of the Lagrangian equation: <span class="math display">\[
\begin{aligned}
&amp; \frac{\partial\mathcal{L}(\omega)}{\partial\omega} = 0 \Leftrightarrow 2\Sigma w = \lambda\iota \Rightarrow \omega = \frac{\lambda}{2}\Sigma^{-1}\iota \\ \end{aligned}
\]</span> Next, the constraint that weights have to sum up to one delivers: <span class="math inline">\(1 = \iota'\omega = \frac{\lambda}{2}\iota'\Sigma^{-1}\iota \Rightarrow \lambda = \frac{2}{\iota'\Sigma^{-1}\iota}.\)</span> Finally, plug-in the derived value of <span class="math inline">\(\lambda\)</span> to get <span class="math display">\[
\begin{aligned}
\omega_\text{mvp} = \frac{\Sigma^{-1}\iota}{\iota'\Sigma^{-1}\iota}.
\end{aligned}
\]</span></p>
</div>
<div id="the-efficient-portfolio" class="section level3" number="20.1.2">
<h3>
<span class="header-section-number">C.1.2</span> The efficient portfolio<a class="anchor" aria-label="anchor" href="#the-efficient-portfolio"><i class="fas fa-link"></i></a>
</h3>
<p>Consider an investor who aims to achieve minimum variance <em>given a desired expected return</em> <span class="math inline">\(\bar{\mu}\)</span>, that is: <span class="math display">\[\omega_\text{eff}\left(\bar{\mu}\right) = \arg\min w'\Sigma w \text{ s.t. } \iota'w = 1 \text{ and } \omega'\mu \geq \bar{\mu}.\]</span> The Lagrangian reads <span class="math display">\[ \mathcal{L}(\omega) = w'\Sigma w - \lambda(w'\iota - 1) - \tilde{\lambda}(\omega'\mu - \bar{\mu}). \]</span> We can solve the first-order conditions to get <span class="math display">\[
\begin{aligned}
2\Sigma w &amp;= \lambda\iota + \tilde\lambda \mu\\
\Rightarrow\omega &amp;= \frac{\lambda}{2}\Sigma^{-1}\iota + \frac{\tilde\lambda}{2}\Sigma^{-1}\mu.
\end{aligned}
\]</span></p>
<p>Next, the two constraints (<span class="math inline">\(w'\iota = 1 \text{ and } \omega'\mu \geq \bar{\mu}\)</span>) imply <span class="math display">\[
\begin{aligned}
1 &amp;= \iota'\omega = \frac{\lambda}{2}\underbrace{\iota'\Sigma^{-1}\iota}_{C} + \frac{\tilde\lambda}{2}\underbrace{\iota'\Sigma^{-1}\mu}_D\\
\Rightarrow \lambda&amp;= \frac{2 - \tilde\lambda D}{C}\\
\bar\mu &amp;= \mu'\omega = \frac{\lambda}{2}\underbrace{\mu'\Sigma^{-1}\iota}_{D} + \frac{\tilde\lambda}{2}\underbrace{\mu'\Sigma^{-1}\mu}_E = \frac{1}{2}\left(\frac{2 - \tilde\lambda D}{C}\right)D+\frac{\tilde\lambda}{2}E  \\&amp;=\frac{D}{C}+\frac{\tilde\lambda}{2}\left(E - \frac{D^2}{C}\right)\\
\Rightarrow \tilde\lambda &amp;= 2\frac{\bar\mu - D/C}{E-D^2/C}.
\end{aligned}
\]</span> As a result, the efficient portfolio weight takes the form (for <span class="math inline">\(\bar{\mu} \geq D/C = \mu'\omega_\text{mvp}\)</span>) <span class="math display">\[w_\text{eff}\left(\bar\mu\right) = \omega_\text{mvp} + \frac{\tilde\lambda}{2}\left(\Sigma^{-1}\mu -\frac{D}{C}\Sigma^{-1}\iota \right).\]</span> Thus, the efficient portfolio allocates wealth in the minimum variance portfolio <span class="math inline">\(\omega_\text{mvp}\)</span> and a levered (self-financing) portfolio to increase the expected return.</p>
<p>Note that the portfolio weights sum up to one as <span class="math display">\[\iota'\left(\Sigma^{-1}\mu -\frac{D}{C}\Sigma^{-1}\iota \right) = D - D = 0\text{ so }\iota'\omega_\text{eff} = \iota'\omega_\text{mvp} = 1.\]</span> Finally, the expected return of the efficient portfolio is <span class="math display">\[\mu'\omega_\text{eff} = \frac{D}{C} + \bar\mu - \frac{D}{C} = \bar\mu.\]</span></p>
</div>
<div id="equivalence-between-certainty-equivalent-maximization-and-minimum-variance-optimization" class="section level3" number="20.1.3">
<h3>
<span class="header-section-number">C.1.3</span> Equivalence between Certainty equivalent maximization and minimum variance optimization<a class="anchor" aria-label="anchor" href="#equivalence-between-certainty-equivalent-maximization-and-minimum-variance-optimization"><i class="fas fa-link"></i></a>
</h3>
<p>We argue that an investor with a quadratic utility function with certainty equivalent <span class="math display">\[\max_w CE(w) = \omega'\mu - \frac{\gamma}{2} \omega'\Sigma \omega \text{ s.t. } \iota'\omega = 1\]</span> faces an equivalent optimization problem to a framework where portfolio weights are chosen with the aim to minimize volatility given a pre-specified level or expected returns <span class="math display">\[\min_w \omega'\Sigma \omega \text{ s.t. } \omega'\mu = \bar\mu \text{ and } \iota'\omega = 1.\]</span> Note the difference: In the first case, the investor has a (known) risk aversion <span class="math inline">\(\gamma\)</span> which determines her optimal balance between risk (<span class="math inline">\(\omega'\Sigma\omega)\)</span> and return (<span class="math inline">\(\mu'\omega\)</span>). In the second case, the investor has a target return she wants to achieve while minimizing the volatility. Intuitively, both approaches are closely connected if we consider that the risk aversion <span class="math inline">\(\gamma\)</span> determines the desirable return <span class="math inline">\(\bar\mu\)</span>. More risk averse investors (higher <span class="math inline">\(\gamma\)</span>) will chose a lower target return to keep their volatility level down. The efficient frontier then spans all possible portfolios depending on the risk aversion <span class="math inline">\(\gamma\)</span>, starting from the minimum variance portfolio (<span class="math inline">\(\gamma = \infty\)</span>).</p>
<p>To proof this equivalence, consider first the optimal portfolio weights for a certainty equivalent maximizing investor. The first order condition reads <span class="math display">\[
\begin{aligned}
\mu - \lambda \iota &amp;= \gamma \Sigma \omega \\
\Leftrightarrow \omega &amp;= \frac{1}{\gamma}\Sigma^{-1}\left(\mu - \lambda\iota\right)
\end{aligned}
\]</span> Next, we make use of the constraint <span class="math inline">\(\iota'\omega = 1\)</span>. <span class="math display">\[
\begin{aligned}
\iota'\omega &amp;= 1 = \frac{1}{\gamma}\left(\iota'\Sigma^{-1}\mu - \lambda\iota'\Sigma^{-1}\iota\right)\\
\Rightarrow \lambda &amp;= \frac{1}{\iota'\Sigma^{-1}\iota}\left(\iota'\Sigma^{-1}\mu - \gamma \right).
\end{aligned}
\]</span> Plug-in the value of <span class="math inline">\(\lambda\)</span> reveals the desired portfolio for an investor with risk aversion <span class="math inline">\(\gamma\)</span>. <span class="math display">\[
\begin{aligned}
\omega &amp;= \frac{1}{\gamma}\Sigma^{-1}\left(\mu - \frac{1}{\iota'\Sigma^{-1}\iota}\left(\iota'\Sigma^{-1}\mu - \gamma \right)\right) \\
\Rightarrow \omega &amp;= \frac{\Sigma^{-1}\iota}{\iota'\Sigma^{-1}\iota} + \frac{1}{\gamma}\left(\Sigma^{-1} - \frac{\Sigma^{-1}\iota}{\iota'\Sigma^{-1}\iota}\iota'\Sigma^{-1}\right)\mu\\
&amp;= \omega_\text{mvp} + \frac{1}{\gamma}\left(\Sigma^{-1}\mu - \frac{\iota'\Sigma^{-1}\mu}{\iota'\Sigma^{-1}\iota}\Sigma^{-1}\iota\right).
\end{aligned}
\]</span> The resulting weights correspond to the efficient portfolio with desired return <span class="math inline">\(\bar r\)</span> such that (in the notation of book) <span class="math display">\[\frac{1}{\gamma} = \frac{\tilde\lambda}{2} = \frac{\bar\mu - D/C}{E - D^2/C}\]</span> which implies that the desired return is just <span class="math display">\[\bar\mu = \frac{D}{C} + \frac{1}{\gamma}\left({E - D^2/C}\right)\]</span> which is <span class="math inline">\(\frac{D}{C} = \mu'\omega_\text{mvp}\)</span> for <span class="math inline">\(\gamma\rightarrow \infty\)</span> as expected. For instance, letting <span class="math inline">\(\gamma \rightarrow \infty\)</span> implies <span class="math inline">\(\bar\mu = \frac{D}{C} = \omega_\text{mvp}'\mu\)</span>.</p>

</div>
</div>
</div>






  <div class="chapter-nav">
<div class="prev"><a href="clean-enhanced-trace-with-r.html"><span class="header-section-number">B</span> Clean Enhanced TRACE with R</a></div>
<div class="empty"></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#proofs"><span class="header-section-number">C</span> Proofs</a></li>
<li>
<a class="nav-link" href="#optimal-portfolio-choice-1"><span class="header-section-number">C.1</span> Optimal portfolio choice</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#the-minimum-variance-portfolio"><span class="header-section-number">C.1.1</span> The minimum variance portfolio</a></li>
<li><a class="nav-link" href="#the-efficient-portfolio"><span class="header-section-number">C.1.2</span> The efficient portfolio</a></li>
<li><a class="nav-link" href="#equivalence-between-certainty-equivalent-maximization-and-minimum-variance-optimization"><span class="header-section-number">C.1.3</span> Equivalence between Certainty equivalent maximization and minimum variance optimization</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/voigtstefan/tidy_finance/blob/main/93_appendix_proofs.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/voigtstefan/tidy_finance/edit/main/93_appendix_proofs.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Tidy Finance with R</strong>" was written by Christoph Scheuch (wikifolio Financial Technologies) and Stefan Voigt (University of Copenhagen and Danish Finance Institute) and Patrick Weiss (Reykjavik University and Vienna University of Economics and Business). It was last built on 2023-02-15.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
