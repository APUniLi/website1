<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 2 Introduction to Tidy Finance | Tidy Finance</title>
<meta name="author" content="Christoph Scheuch, Patrick Weiss and Stefan Voigt">
<meta name="description" content="The main aim of this chapter is to familiarize yourself with the tidyverse. We start out by downloading and visualizing stock data before we move to a simple portfolio choice problem. These...">
<meta name="generator" content="bookdown 0.24.4 with bs4_book()">
<meta property="og:title" content="Chapter 2 Introduction to Tidy Finance | Tidy Finance">
<meta property="og:type" content="book">
<meta property="og:description" content="The main aim of this chapter is to familiarize yourself with the tidyverse. We start out by downloading and visualizing stock data before we move to a simple portfolio choice problem. These...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 2 Introduction to Tidy Finance | Tidy Finance">
<meta name="twitter:description" content="The main aim of this chapter is to familiarize yourself with the tidyverse. We start out by downloading and visualizing stock data before we move to a simple portfolio choice problem. These...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Tidy Finance</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Prerequisites</a></li>
<li><a class="active" href="introduction-to-tidy-finance.html"><span class="header-section-number">2</span> Introduction to Tidy Finance</a></li>
<li><a class="" href="accessing-managing-financial-data.html"><span class="header-section-number">3</span> Accessing &amp; Managing Financial Data</a></li>
<li><a class="" href="estimating-beta.html"><span class="header-section-number">4</span> Estimating Beta</a></li>
<li><a class="" href="univariate-sorts.html"><span class="header-section-number">5</span> Univariate Sorts</a></li>
<li><a class="" href="univariate-sorts-firm-size.html"><span class="header-section-number">6</span> Univariate Sorts: Firm Size</a></li>
<li><a class="" href="bivariate-sorts-value.html"><span class="header-section-number">7</span> Bivariate Sorts: Value</a></li>
<li><a class="" href="factor-selection-via-machine-learning.html"><span class="header-section-number">8</span> Factor selection via machine learning</a></li>
<li><a class="" href="option-pricing-via-machine-learning-methods.html"><span class="header-section-number">9</span> Option Pricing via Machine learning methods</a></li>
<li><a class="" href="parametric-portfolio-policies.html"><span class="header-section-number">10</span> Parametric Portfolio Policies</a></li>
<li><a class="" href="constraint-optimization-and-portfolio-backtesting.html"><span class="header-section-number">11</span> Constraint Optimization and Portfolio Backtesting</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="introduction-to-tidy-finance" class="section level1" number="2">
<h1>
<span class="header-section-number">2</span> Introduction to Tidy Finance<a class="anchor" aria-label="anchor" href="#introduction-to-tidy-finance"><i class="fas fa-link"></i></a>
</h1>
<p>The main aim of this chapter is to familiarize yourself with the <code>tidyverse</code>. We start out by downloading and visualizing stock data before we move to a simple portfolio choice problem. These examples introduce you to our approach of <em>tidy finance</em>.</p>
<div id="stock_market_data" class="section level2" number="2.1">
<h2>
<span class="header-section-number">2.1</span> Download and work with stock market data<a class="anchor" aria-label="anchor" href="#stock_market_data"><i class="fas fa-link"></i></a>
</h2>
<p>To download price data you can use the convenient <code>tidyquant</code>package.
If you have trouble using <code>tidyquant</code>, check out the <a href="https://cran.r-project.org/web/packages/tidyquant/vignettes/TQ01-core-functions-in-tidyquant.html#yahoo-finance">documentation</a>. Start the session by loading the <code>tidyverse</code> and the <code>tidyquant</code> package as shown below.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("tidyverse")</span>
<span class="co"># install.packages("tidyquant")</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/business-science/tidyquant">tidyquant</a></span><span class="op">)</span></code></pre></div>
<p>We start and download daily prices for one stock market ticker, e.g. <em>AAPL</em>, directly from data provider Yahoo!Finance. To download the data you can use the command <code>tq_get</code>. If you do not know how to use it, make sure you read the help file by calling <code><a href="https://rdrr.io/pkg/tidyquant/man/tq_get.html">?tq_get</a></code>. We especially recommended to take a look in the examples section in the documentation.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">prices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tidyquant/man/tq_get.html">tq_get</a></span><span class="op">(</span><span class="st">"AAPL"</span>, get <span class="op">=</span> <span class="st">"stock.prices"</span><span class="op">)</span>
<span class="va">prices</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># Take a glimpse on the data</span></code></pre></div>
<pre><code>## # A tibble: 6 x 8
##   symbol date        open  high   low close    volume adjusted
##   &lt;chr&gt;  &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1 AAPL   2012-01-03  14.6  14.7  14.6  14.7 302220800     12.6
## 2 AAPL   2012-01-04  14.6  14.8  14.6  14.8 260022000     12.7
## 3 AAPL   2012-01-05  14.8  14.9  14.7  14.9 271269600     12.8
## 4 AAPL   2012-01-06  15.0  15.1  15.0  15.1 318292800     12.9
## # ... with 2 more rows</code></pre>
<p><code>tq_get</code> downloads stock market data from Yahoo!Finance if you do not specify another data source. The function returns a tibble with 8 quite self-explanatory columns: <em>symbol</em>, <em>date</em>, the market prices at the <em>open, high, low</em> and <em>close</em>, the daily <em>volume</em> (in number of shares) and the <em>adjusted</em> price in USD which factors in anything that might affect the stock price after the market closes, e.g. stock splits, repurchases and dividends.</p>
<p>Next, we use <code>ggplot</code> to visualize the time series of adjusted prices.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">prices</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span> <span class="co"># Simple visualization of the downloaded price time series</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">adjusted</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="cn">NULL</span>,
    y <span class="op">=</span> <span class="cn">NULL</span>,
    title <span class="op">=</span> <span class="st">"AAPL stock prices"</span>,
    subtitle <span class="op">=</span> <span class="st">"Prices in USD, adjusted for dividend payments and stock splits"</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="10_introduction_files/figure-html/unnamed-chunk-3-1.png" width="672" style="display: block; margin: auto;">
Next, we compute daily returns defined as <span class="math inline">\((p_t - p_{t-1}) / p_{t-1}\)</span> where <span class="math inline">\(p_t\)</span> is the adjusted day <span class="math inline">\(t\)</span> price.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">returns</span> <span class="op">&lt;-</span> <span class="va">prices</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>ret <span class="op">=</span> <span class="va">adjusted</span> <span class="op">/</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="va">adjusted</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">symbol</span>, <span class="va">date</span>, <span class="va">ret</span><span class="op">)</span>
<span class="va">returns</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   symbol date            ret
##   &lt;chr&gt;  &lt;date&gt;        &lt;dbl&gt;
## 1 AAPL   2012-01-03 NA      
## 2 AAPL   2012-01-04  0.00537
## 3 AAPL   2012-01-05  0.0111 
## 4 AAPL   2012-01-06  0.0105 
## # ... with 2 more rows</code></pre>
<p>The resulting tibble contains three columns where the last contains the daily returns. Note that the first entry naturally contains <code>NA</code> because there is no leading price. Note also that the computations require that the time series is ordered by date - otherwise, <code>lag</code> would be meaningless.
For the upcoming examples we remove missing values as these would require careful treatment when computing, e.g., sample averages. In general, however, make sure you understand why <code>NA</code> values occur and if you can simply get rid of these observations.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">returns</span> <span class="op">&lt;-</span> <span class="va">returns</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">ret</span><span class="op">)</span></code></pre></div>
<p>Next, we visualize the distribution of daily returns in a histogram. Just for fun, we also add a dashed red line that indicates the 5% quantile of the daily returns to the histogram - this value is a (crude) proxy for the worst return of the stock with a probability of at least 5%.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">quantile_05</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="va">returns</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">ret</span><span class="op">)</span>, <span class="fl">0.05</span><span class="op">)</span> <span class="co"># Compute the 5 % quantile of the returns</span>

<span class="va">returns</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span> <span class="co"># create a histogram for daily returns</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ret</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">quantile_05</span><span class="op">)</span>,
    color <span class="op">=</span> <span class="st">"red"</span>,
    linetype <span class="op">=</span> <span class="st">"dashed"</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span>,
    title <span class="op">=</span> <span class="st">"Distribution of daily AAPL returns (in percent)"</span>,
    subtitle <span class="op">=</span> <span class="st">"The dotted vertical line indicates the historical 5% quantile"</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10_introduction_files/figure-html/unnamed-chunk-6-1.png" width="672" style="display: block; margin: auto;"></div>
<p>Here, <code>bins = 100</code> determines the number of bins and hence implicitly the width of the bins. Before proceeding, make sure you understand how to use the geom <code><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline()</a></code> to add a dotted red line that indicates the 5% quantile of the daily returns.
A typical task before proceeding with <em>any</em> data is to compute summary statistics for the main variables of interest.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">returns</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span>
    <span class="va">ret</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
      daily_mean <span class="op">=</span> <span class="va">mean</span>,
      daily_sd <span class="op">=</span> <span class="va">sd</span>,
      daily_min <span class="op">=</span> <span class="va">min</span>,
      daily_max <span class="op">=</span> <span class="va">max</span>
    <span class="op">)</span>
  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span>
  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
ret_daily_mean
</th>
<th style="text-align:right;">
ret_daily_sd
</th>
<th style="text-align:right;">
ret_daily_min
</th>
<th style="text-align:right;">
ret_daily_max
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.018
</td>
<td style="text-align:right;">
-0.129
</td>
<td style="text-align:right;">
0.12
</td>
</tr></tbody>
</table></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Alternatively: compute summary statistics for each year</span>
<span class="va">returns</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span>
    <span class="va">ret</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
      daily_mean <span class="op">=</span> <span class="va">mean</span>,
      daily_sd <span class="op">=</span> <span class="va">sd</span>,
      daily_min <span class="op">=</span> <span class="va">min</span>,
      daily_max <span class="op">=</span> <span class="va">max</span>
    <span class="op">)</span>
  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span>
  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:right;">
year
</th>
<th style="text-align:right;">
ret_daily_mean
</th>
<th style="text-align:right;">
ret_daily_sd
</th>
<th style="text-align:right;">
ret_daily_min
</th>
<th style="text-align:right;">
ret_daily_max
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
2012
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.019
</td>
<td style="text-align:right;">
-0.064
</td>
<td style="text-align:right;">
0.089
</td>
</tr>
<tr>
<td style="text-align:right;">
2013
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.018
</td>
<td style="text-align:right;">
-0.124
</td>
<td style="text-align:right;">
0.051
</td>
</tr>
<tr>
<td style="text-align:right;">
2014
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.014
</td>
<td style="text-align:right;">
-0.080
</td>
<td style="text-align:right;">
0.082
</td>
</tr>
<tr>
<td style="text-align:right;">
2015
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.017
</td>
<td style="text-align:right;">
-0.061
</td>
<td style="text-align:right;">
0.057
</td>
</tr>
<tr>
<td style="text-align:right;">
2016
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.015
</td>
<td style="text-align:right;">
-0.066
</td>
<td style="text-align:right;">
0.065
</td>
</tr>
<tr>
<td style="text-align:right;">
2017
</td>
<td style="text-align:right;">
0.002
</td>
<td style="text-align:right;">
0.011
</td>
<td style="text-align:right;">
-0.039
</td>
<td style="text-align:right;">
0.061
</td>
</tr>
<tr>
<td style="text-align:right;">
2018
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.018
</td>
<td style="text-align:right;">
-0.066
</td>
<td style="text-align:right;">
0.070
</td>
</tr>
<tr>
<td style="text-align:right;">
2019
</td>
<td style="text-align:right;">
0.003
</td>
<td style="text-align:right;">
0.016
</td>
<td style="text-align:right;">
-0.100
</td>
<td style="text-align:right;">
0.068
</td>
</tr>
<tr>
<td style="text-align:right;">
2020
</td>
<td style="text-align:right;">
0.003
</td>
<td style="text-align:right;">
0.029
</td>
<td style="text-align:right;">
-0.129
</td>
<td style="text-align:right;">
0.120
</td>
</tr>
<tr>
<td style="text-align:right;">
2021
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.016
</td>
<td style="text-align:right;">
-0.042
</td>
<td style="text-align:right;">
0.054
</td>
</tr>
<tr>
<td style="text-align:right;">
2022
</td>
<td style="text-align:right;">
-0.002
</td>
<td style="text-align:right;">
0.016
</td>
<td style="text-align:right;">
-0.027
</td>
<td style="text-align:right;">
0.025
</td>
</tr>
</tbody>
</table></div>
</div>
<div id="scale-the-analysis-up-tidyverse-magic" class="section level2" number="2.2">
<h2>
<span class="header-section-number">2.2</span> Scale the analysis up: tidyverse-magic<a class="anchor" aria-label="anchor" href="#scale-the-analysis-up-tidyverse-magic"><i class="fas fa-link"></i></a>
</h2>
<p>As a next step, we want to take the code from before and generalize it such that all the computations are performed for an arbitrary vector of tickers or even for all stocks that represent an index. Following tidy principles, it turns out to be actually quite easy to automate the download, generate the plot of the price time series and the table of summary statistics for an arbitrary number of assets.</p>
<p>This is where the <code>tidyverse</code> magic starts: tidy data and a tidy workflow make it extremely easy to generalize the computations from before to as many assets you like. The following code takes any vector of tickers, e.g., <code>ticker &lt;- c("AAPL", "MMM", "BA")</code>, and automates the download as well as the plot of the price time series. At the end, we create the table of summary statistics for an arbitrary number of assets.</p>
<p>Figure <span class="citation">(<a href="#ref-ref" role="doc-biblioref"><strong>ref?</strong></a>)</span>(fig:prices) illustrates the time series of downloaded <em>adjusted</em> prices for each of the 30 constituents of the Dow Jones index. Make sure you understand every single line of code! (What is the purpose of <code>%&gt;%</code>? What are the arguments of <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code>? Which alternative <em>geoms</em> could you use to visualize the time series? Hint: if you do not know the answers try to change the code to see what difference your intervention causes).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ticker</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tidyquant/man/tq_index.html">tq_index</a></span><span class="op">(</span><span class="st">"DOW"</span><span class="op">)</span> <span class="co"># tidyquant delivers all constituents of the Dow Jones index</span>
<span class="va">index_prices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tidyquant/man/tq_get.html">tq_get</a></span><span class="op">(</span><span class="va">ticker</span>,
  get <span class="op">=</span> <span class="st">"stock.prices"</span>,
  from <span class="op">=</span> <span class="st">"2000-01-01"</span>
<span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span> <span class="co"># Exactly the same code as in the first part</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">symbol</span> <span class="op">!=</span> <span class="st">"DOW"</span><span class="op">)</span> <span class="co"># Exclude the index itself</span>

<span class="va">index_prices</span> <span class="op">&lt;-</span> <span class="va">index_prices</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span> <span class="co"># Remove assets that did not trade since January 1st 2000</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">symbol</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">n</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">n</span><span class="op">)</span>

<span class="va">index_prices</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="va">date</span>,
    y <span class="op">=</span> <span class="va">adjusted</span>,
    color <span class="op">=</span> <span class="va">symbol</span>
  <span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="cn">NULL</span>,
    y <span class="op">=</span> <span class="cn">NULL</span>,
    color <span class="op">=</span> <span class="cn">NULL</span>,
    title <span class="op">=</span> <span class="st">"DOW index stock prices"</span>,
    subtitle <span class="op">=</span> <span class="st">"Prices in USD, adjusted for dividend payments and stock splits"</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10_introduction_files/figure-html/fig:prices-1.png" width="672" style="display: block; margin: auto;"></div>
<p>Do you notice the small differences relative to the code we used before? <code>tq_get(ticker)</code> is able to return a tibble for several symbols as well. All we need to do to illustrate all tickers instead of only one is to include <code>color = symbol</code> in the <code>ggplot</code> aesthetics. In this way, we can generate a separate line for each ticker.</p>
<p>The same holds for returns as well. Before computing returns as before, we use <code>group_by(symbol)</code> such that the <code>mutate</code> command is performed for each symbol individually. Exactly the same logic applies for the computation of summary statistics: <code>group_by(symbol)</code> is the key to aggregate the time series into ticker-specific variables of interest.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">all_returns</span> <span class="op">&lt;-</span> <span class="va">index_prices</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">symbol</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span> <span class="co"># we perform the computations per symbol</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>ret <span class="op">=</span> <span class="va">adjusted</span> <span class="op">/</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="va">adjusted</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">symbol</span>, <span class="va">date</span>, <span class="va">ret</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">ret</span><span class="op">)</span>

<span class="va">all_returns</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">symbol</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span>
    <span class="va">ret</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
      daily_mean <span class="op">=</span> <span class="va">mean</span>,
      daily_sd <span class="op">=</span> <span class="va">sd</span>,
      daily_min <span class="op">=</span> <span class="va">min</span>,
      daily_max <span class="op">=</span> <span class="va">max</span>
    <span class="op">)</span>
  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span>
  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<div class="inline-table"><table class="table table-sm">
<thead><tr>
<th style="text-align:left;">
symbol
</th>
<th style="text-align:right;">
ret_daily_mean
</th>
<th style="text-align:right;">
ret_daily_sd
</th>
<th style="text-align:right;">
ret_daily_min
</th>
<th style="text-align:right;">
ret_daily_max
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
AMGN
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.020
</td>
<td style="text-align:right;">
-0.134
</td>
<td style="text-align:right;">
0.151
</td>
</tr>
<tr>
<td style="text-align:left;">
AXP
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.023
</td>
<td style="text-align:right;">
-0.176
</td>
<td style="text-align:right;">
0.219
</td>
</tr>
<tr>
<td style="text-align:left;">
BA
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.022
</td>
<td style="text-align:right;">
-0.238
</td>
<td style="text-align:right;">
0.243
</td>
</tr>
<tr>
<td style="text-align:left;">
CAT
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.020
</td>
<td style="text-align:right;">
-0.145
</td>
<td style="text-align:right;">
0.147
</td>
</tr>
<tr>
<td style="text-align:left;">
CSCO
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.024
</td>
<td style="text-align:right;">
-0.162
</td>
<td style="text-align:right;">
0.244
</td>
</tr>
<tr>
<td style="text-align:left;">
CVX
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.017
</td>
<td style="text-align:right;">
-0.221
</td>
<td style="text-align:right;">
0.227
</td>
</tr>
<tr>
<td style="text-align:left;">
DIS
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.019
</td>
<td style="text-align:right;">
-0.184
</td>
<td style="text-align:right;">
0.160
</td>
</tr>
<tr>
<td style="text-align:left;">
GS
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.023
</td>
<td style="text-align:right;">
-0.190
</td>
<td style="text-align:right;">
0.265
</td>
</tr>
<tr>
<td style="text-align:left;">
HD
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.019
</td>
<td style="text-align:right;">
-0.287
</td>
<td style="text-align:right;">
0.141
</td>
</tr>
<tr>
<td style="text-align:left;">
HON
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.020
</td>
<td style="text-align:right;">
-0.174
</td>
<td style="text-align:right;">
0.282
</td>
</tr>
<tr>
<td style="text-align:left;">
IBM
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.017
</td>
<td style="text-align:right;">
-0.155
</td>
<td style="text-align:right;">
0.120
</td>
</tr>
<tr>
<td style="text-align:left;">
INTC
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.024
</td>
<td style="text-align:right;">
-0.220
</td>
<td style="text-align:right;">
0.201
</td>
</tr>
<tr>
<td style="text-align:left;">
JNJ
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.012
</td>
<td style="text-align:right;">
-0.158
</td>
<td style="text-align:right;">
0.122
</td>
</tr>
<tr>
<td style="text-align:left;">
JPM
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.024
</td>
<td style="text-align:right;">
-0.207
</td>
<td style="text-align:right;">
0.251
</td>
</tr>
<tr>
<td style="text-align:left;">
KO
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.013
</td>
<td style="text-align:right;">
-0.101
</td>
<td style="text-align:right;">
0.139
</td>
</tr>
<tr>
<td style="text-align:left;">
MCD
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.015
</td>
<td style="text-align:right;">
-0.159
</td>
<td style="text-align:right;">
0.181
</td>
</tr>
<tr>
<td style="text-align:left;">
MMM
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.015
</td>
<td style="text-align:right;">
-0.129
</td>
<td style="text-align:right;">
0.126
</td>
</tr>
<tr>
<td style="text-align:left;">
MRK
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.017
</td>
<td style="text-align:right;">
-0.268
</td>
<td style="text-align:right;">
0.130
</td>
</tr>
<tr>
<td style="text-align:left;">
MSFT
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.019
</td>
<td style="text-align:right;">
-0.156
</td>
<td style="text-align:right;">
0.196
</td>
</tr>
<tr>
<td style="text-align:left;">
NKE
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.019
</td>
<td style="text-align:right;">
-0.198
</td>
<td style="text-align:right;">
0.155
</td>
</tr>
<tr>
<td style="text-align:left;">
PG
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.013
</td>
<td style="text-align:right;">
-0.302
</td>
<td style="text-align:right;">
0.120
</td>
</tr>
<tr>
<td style="text-align:left;">
TRV
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.018
</td>
<td style="text-align:right;">
-0.208
</td>
<td style="text-align:right;">
0.256
</td>
</tr>
<tr>
<td style="text-align:left;">
UNH
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.020
</td>
<td style="text-align:right;">
-0.186
</td>
<td style="text-align:right;">
0.348
</td>
</tr>
<tr>
<td style="text-align:left;">
VZ
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.015
</td>
<td style="text-align:right;">
-0.118
</td>
<td style="text-align:right;">
0.146
</td>
</tr>
<tr>
<td style="text-align:left;">
WBA
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.018
</td>
<td style="text-align:right;">
-0.150
</td>
<td style="text-align:right;">
0.166
</td>
</tr>
<tr>
<td style="text-align:left;">
WMT
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.015
</td>
<td style="text-align:right;">
-0.102
</td>
<td style="text-align:right;">
0.117
</td>
</tr>
<tr>
<td style="text-align:left;">
AAPL
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.025
</td>
<td style="text-align:right;">
-0.519
</td>
<td style="text-align:right;">
0.139
</td>
</tr>
</tbody>
</table></div>
<p>Note that you are now also equipped with all tools to download price data for <em>each</em> ticker listed in the SP500 index with the same number of lines of code. Just use <code>ticker &lt;- tq_index("SP500")</code> which provides you with a tibble that contains each symbol that is (currently) part of the SP500. However, don’t try this if you are not prepared to wait for a couple of minutes.</p>
<p>Sometimes, aggregation across other variables than <code>symbol</code> makes sense as well. For instance, suppose you are interested in the question: are days with high aggregate trading volume followed by high aggregate trading volume days? To provide some initial analysis on this question we take the downloaded tibble with prices and compute aggregate daily trading volume for all Dow Jones constituents in USD. Recall that the column <em>volume</em> is denoted in the number of traded shares. We multiply the trading volume with the daily closing price to get a measure of the aggregate trading volume in USD. Scaling by <code>1e9</code> denotes daily trading volume in billion USD.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">volume</span> <span class="op">&lt;-</span> <span class="va">index_prices</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>volume_usd <span class="op">=</span> <span class="va">volume</span> <span class="op">*</span> <span class="va">close</span> <span class="op">/</span> <span class="fl">1e9</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>volume <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">volume_usd</span><span class="op">)</span><span class="op">)</span>

<span class="va">volume</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span> <span class="co"># Plot the time series of aggregate trading volume</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">volume</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="cn">NULL</span>, y <span class="op">=</span> <span class="cn">NULL</span>,
    title <span class="op">=</span> <span class="st">"Aggregate trading volume (billion USD)"</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="10_introduction_files/figure-html/unnamed-chunk-10-1.png" width="672" style="display: block; margin: auto;"></div>
<p>One way to illustrate the persistence of trading volume would be to plot volume on day <span class="math inline">\(t\)</span> against volume on day <span class="math inline">\(t-1\)</span> as in the example below:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">volume</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="va">volume</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">volume</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>, slope <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">"Previous day aggregate trading volume (billion USD)"</span>,
    y <span class="op">=</span> <span class="st">"Aggregate trading volume (billion USD)"</span>,
    title <span class="op">=</span> <span class="st">"Persistence of trading volume"</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"None"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_point).</code></pre>
<div class="inline-figure"><img src="10_introduction_files/figure-html/aggregate-volume-1.png" width="672" style="display: block; margin: auto;"></div>
<p>Do you understand where the warning <code>## Warning: Removed 1 rows containing missing values (geom_point).</code> comes from and what it means? Pure eye-balling reveals that days with high trading volume are often followed by similarly high trading volume days.</p>
</div>
<div id="portfolio-choice-problems" class="section level2" number="2.3">
<h2>
<span class="header-section-number">2.3</span> Portfolio choice problems<a class="anchor" aria-label="anchor" href="#portfolio-choice-problems"><i class="fas fa-link"></i></a>
</h2>
<p>A very typically question in Finance is how to optimally allocate wealth across different assets. The standard framework for optimal portfolio selection is based on investors that dislike portfolio return volatility and like higher expected returns: the mean-variance investor. An essential tool to evaluate portfolios is the efficient frontier, the set of portfolios which satisfy the condition that no other portfolio exists with a higher expected return but with the same standard deviation of return (i.e., the risk). Let us compute and visualize the efficient frontier for a number of stocks. First, we use our dataset to compute the <em>monthly</em> returns for each asset.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">returns</span> <span class="op">&lt;-</span> <span class="va">index_prices</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>month <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/round_date.html">floor_date</a></span><span class="op">(</span><span class="va">date</span>, <span class="st">"month"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">symbol</span>, <span class="va">month</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>price <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html">last</a></span><span class="op">(</span><span class="va">adjusted</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop_last"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>ret <span class="op">=</span> <span class="va">price</span> <span class="op">/</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/lead-lag.html">lag</a></span><span class="op">(</span><span class="va">price</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="va">ret</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">price</span><span class="op">)</span></code></pre></div>
<p>Next, we transform the returns from a tidy tibble into a <span class="math inline">\((T \times N)\)</span> matrix with one column for each ticker to compute the covariance matrix <span class="math inline">\(\Sigma\)</span> and also the expected return vector <span class="math inline">\(\mu\)</span>.
We compute the vector of sample average returns and the sample variance covariance matrix.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">returns_matrix</span> <span class="op">&lt;-</span> <span class="va">returns</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>
    names_from <span class="op">=</span> <span class="va">symbol</span>,
    values_from <span class="op">=</span> <span class="va">ret</span>
  <span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">month</span><span class="op">)</span>

<span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cov</a></span><span class="op">(</span><span class="va">returns_matrix</span><span class="op">)</span>
<span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">returns_matrix</span><span class="op">)</span></code></pre></div>
<p>Then, we compute the minimum variance portfolio weight <span class="math inline">\(\omega_\text{mvp}\)</span> as well as the expected return <span class="math inline">\(\omega_\text{mvp}'\mu\)</span> and volatility <span class="math inline">\(\sqrt{\omega_\text{mvp}'\Sigma\omega_\text{mvp}}\)</span> of this portfolio. Recall that the minimum variance portfolio is the vector of portfolio weights that are the solution to
<span class="math display">\[\arg\min w'\Sigma w \text{ s.t. } \sum\limits_{i=1}^Nw_i = 1.\]</span>
It is easy to show analytically, that <span class="math inline">\(\omega_\text{mvp} = \frac{\Sigma^{-1}\iota}{\iota'\Sigma^{-1}\iota}\)</span> where <span class="math inline">\(\iota\)</span> is a vector of ones.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">returns_matrix</span><span class="op">)</span>
<span class="va">iota</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">N</span><span class="op">)</span>
<span class="va">wmvp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span><span class="op">(</span><span class="va">sigma</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">iota</span>
<span class="va">wmvp</span> <span class="op">&lt;-</span> <span class="va">wmvp</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">wmvp</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">wmvp</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">mu</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">wmvp</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">sigma</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">wmvp</span><span class="op">)</span><span class="op">)</span> <span class="co"># Expected return and volatility</span></code></pre></div>
<pre><code>## [1] 0.008493936 0.031390398</code></pre>
<p>Note that the <em>monthly</em> volatility of the minimum variance portfolio is of the same order of magnitude than the <em>daily</em> standard deviation of the individual components. Thus, the diversification benefits are tremendous!
Next we compute the efficient portfolio weights which achieves 3 times the expected return of the minimum variance portfolio. If you wonder where the solution <span class="math inline">\(\omega_\text{eff}\)</span> comes from: The efficient portfolio is chosen by an investor who aims to achieve minimum variance <em>given a minimum desired expected return</em> <span class="math inline">\(\bar{\mu}\)</span> such that her objective function is to choose <span class="math inline">\(\omega_\text{eff}\)</span> as the solution to
<span class="math display">\[\arg\min w'\Sigma w \text{ s.t. } w'\iota = 1 \text{ and } \omega'\mu \geq \bar{\mu}.\]</span>
The code below implements the analytic solution to this optimization problem, we encourage you to verify that it is correct.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Compute efficient portfolio weights for given level of expected return</span>
<span class="va">mu_bar</span> <span class="op">&lt;-</span> <span class="fl">3</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">wmvp</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">mu</span> <span class="co"># some benchmark return: 3 times the minimum variance portfolio expected return</span>

<span class="va">C</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">iota</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span><span class="op">(</span><span class="va">sigma</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">iota</span><span class="op">)</span>
<span class="va">D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">iota</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span><span class="op">(</span><span class="va">sigma</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">mu</span><span class="op">)</span>
<span class="va">E</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span><span class="op">(</span><span class="va">sigma</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">mu</span><span class="op">)</span>

<span class="va">lambda_tilde</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="va">mu_bar</span> <span class="op">-</span> <span class="va">D</span> <span class="op">/</span> <span class="va">C</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">E</span> <span class="op">-</span> <span class="va">D</span><span class="op">^</span><span class="fl">2</span> <span class="op">/</span> <span class="va">C</span><span class="op">)</span><span class="op">)</span>
<span class="va">weff</span> <span class="op">&lt;-</span> <span class="va">wmvp</span> <span class="op">+</span> <span class="va">lambda_tilde</span> <span class="op">/</span> <span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span><span class="op">(</span><span class="va">sigma</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">mu</span> <span class="op">-</span> <span class="va">D</span> <span class="op">/</span> <span class="va">C</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span><span class="op">(</span><span class="va">sigma</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">iota</span><span class="op">)</span></code></pre></div>
<p>The two mutual fund theorem states that as soon as we have two efficient portfolios (such as the minimum variance portfolio and the efficient portfolio for another required level of expected returns like above), we can characterize the entire efficient frontier by combining these two portfolios. This is done in the code below. Make sure to familiarize yourself with the inner workings of the <code>for</code> loop!.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Use the two mutual fund theorem</span>
<span class="va">c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="op">-</span><span class="fl">0.4</span>, to <span class="op">=</span> <span class="fl">1.9</span>, by <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span> <span class="co"># Some values for a linear combination of two efficient portfolio weights</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>
  c <span class="op">=</span> <span class="va">c</span>,
  mu <span class="op">=</span> <span class="cn">NA</span>,
  sd <span class="op">=</span> <span class="cn">NA</span>
<span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">c</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span> <span class="co"># A for loop</span>
  <span class="va">w</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">c</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="va">wmvp</span> <span class="op">+</span> <span class="op">(</span><span class="va">c</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="va">weff</span> <span class="co"># A portfolio of minimum variance and efficient portfolio</span>
  <span class="va">res</span><span class="op">$</span><span class="va">mu</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">12</span> <span class="op">*</span> <span class="fl">100</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">w</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">mu</span> <span class="co"># Portfolio expected return (annualized, in percent)</span>
  <span class="va">res</span><span class="op">$</span><span class="va">sd</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">12</span> <span class="op">*</span> <span class="fl">10</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">w</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">sigma</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="va">w</span><span class="op">)</span> <span class="co"># Portfolio volatility (annualized, in percent)</span>
<span class="op">}</span></code></pre></div>
<p>Finally, it is simple to visualize everything within one, powerful figure using <code>ggplot2</code>.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Visualize the efficient frontier</span>
<span class="va">res</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">sd</span>, y <span class="op">=</span> <span class="va">mu</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Plot all sd/mu portfolio combinations</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">res</span> <span class="op"><a href="https://rdrr.io/pkg/tidyquant/man/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">c</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,
    color <span class="op">=</span> <span class="st">"red"</span>,
    size <span class="op">=</span> <span class="fl">4</span>
  <span class="op">)</span> <span class="op">+</span> <span class="co"># locate the minimum variance and efficient portfolio</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>mu <span class="op">=</span> <span class="fl">12</span> <span class="op">*</span> <span class="fl">100</span> <span class="op">*</span> <span class="va">mu</span>, sd <span class="op">=</span> <span class="fl">12</span> <span class="op">*</span> <span class="fl">10</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">sigma</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">mu</span>, x <span class="op">=</span> <span class="va">sd</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"blue"</span>, size <span class="op">=</span> <span class="fl">1</span>
  <span class="op">)</span> <span class="op">+</span> <span class="co"># locate the individual assets</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="co"># make the plot a bit nicer</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="st">"Annualized standard deviation (in percent)"</span>,
    y <span class="op">=</span> <span class="st">"Annualized expected return (in percent)"</span>,
    title <span class="op">=</span> <span class="st">"Dow Jones asset returns and efficient frontier"</span>,
    subtitle <span class="op">=</span> <span class="st">"Red dots indicate the location of the minimum variance and efficient tangency portfolio"</span>
  <span class="op">)</span></code></pre></div>
<p><img src="10_introduction_files/figure-html/unnamed-chunk-16-1.png" width="672" style="display: block; margin: auto;">
The black efficient frontier indicates the set of portfolio a mean-variance efficient investor would choose from. Compare the performance relative to the individual assets (the blue dots) - it should become clear that diversifying yields massive performance gains (at least as long as we take the parameters <span class="math inline">\(\Sigma\)</span> and <span class="math inline">\(\mu\)</span> as given).</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="index.html"><span class="header-section-number">1</span> Prerequisites</a></div>
<div class="next"><a href="accessing-managing-financial-data.html"><span class="header-section-number">3</span> Accessing &amp; Managing Financial Data</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#introduction-to-tidy-finance"><span class="header-section-number">2</span> Introduction to Tidy Finance</a></li>
<li><a class="nav-link" href="#stock_market_data"><span class="header-section-number">2.1</span> Download and work with stock market data</a></li>
<li><a class="nav-link" href="#scale-the-analysis-up-tidyverse-magic"><span class="header-section-number">2.2</span> Scale the analysis up: tidyverse-magic</a></li>
<li><a class="nav-link" href="#portfolio-choice-problems"><span class="header-section-number">2.3</span> Portfolio choice problems</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Tidy Finance</strong>" was written by Christoph Scheuch, Patrick Weiss and Stefan Voigt. It was last built on 2022-01-18.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
