---
title: Clean Enhanced TRACE with Python
metadata:
  pagetitle: Clean Enhanced TRACE with Python
  description-meta: Copy the code to clean enhanced TRACE bond transaction data using the programming language Python.
---

This appendix contains code to clean enhanced TRACE with Python. It is also available via the following Github [gist](https://gist.github.com/patrick-weiss/86ddef6de978fbdfb22609a7840b5d8b).\index{Github!Gist} Hence, you could also source the file with the following chunk.

```{python}
gist_url = "https://gist.github.com/patrick-weiss/86ddef6de978fbdfb22609a7840b5d8b"

with httpimport.remote_repo(gist_url):
  import cleaning_function
```

We need this function in Chapter [TRACE and FISD](trace-and-fisd.qmd) to download and clean enhanced TRACE trade messages following @Dick2009 and @Dick2014 for enhanced TRACE specifically. This code is based on the resources provided by the project [Open Source Bond Asset Pricing](https://openbondassetpricing.com/) and their related publication @Dickerson2023. We encourage that you achknowledge their effort. Related, WRDS provides SAS code to clean enhanced TRACE data.

The function takes a vector of CUSIPs (in `cusips`), a connection to WRDS (`connection`) explained in Chapter 3, and a start and end date (`start_date` and `end_date`, respectively). Specifying too many CUSIPs will result in very slow downloads and a potential failure due to the size of the request to WRDS. The dates should be within the coverage of TRACE itself, i.e., starting after 2002, and the dates should be supplied using the class date. The output of the function contains all valid trade messages for the selected CUSIPs over the specified period.\index{CUSIP}\index{Dick-Nielsen cleaning} 

